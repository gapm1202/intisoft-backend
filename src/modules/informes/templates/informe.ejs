<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Informe de Soporte</title>
    <style>
      :root{--indigo:#4f46e5;--gray-700:#374151;--muted:#6b7280}
      body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:var(--gray-700); margin:0; padding:20px}
      .header{display:flex;align-items:center;gap:16px}
      .logo{width:96px;height:48px;object-fit:contain}
      .title{color:var(--indigo);font-size:20px;font-weight:700}
      .meta{font-size:12px;color:var(--muted)}
      .section{margin-top:18px}
      .section h3{margin:0 0 8px 0;color:var(--indigo);font-size:14px}
      .grid{display:flex;gap:12px;flex-wrap:wrap}
      .card{border:1px solid #e5e7eb;padding:10px;border-radius:6px;background:white;flex:1}
      .photos img{max-width:260px;max-height:180px;margin-right:8px;border-radius:4px}
      .signature img{max-width:300px;max-height:120px}
      table{width:100%;border-collapse:collapse}
      td,th{padding:8px;border:1px solid #e5e7eb;text-align:left}
    </style>
  </head>
  <body>
    <div class="header">
      <img class="logo" src="<%= payload.metadata.logoUrl || 'https://via.placeholder.com/150x50?text=Logo' %>" alt="logo"/>
      <div>
        <div class="title">Informe de Soporte Inicial</div>
        <div class="meta"><%= payload.empresaNombre %> — <%= payload.sedeNombre %></div>
        <div class="meta">Activo: <strong><%= payload.assetId %></strong></div>
      </div>
    </div>

    <div class="section">
      <h3>Datos del técnico y fecha</h3>
      <div class="grid">
        <div class="card">Técnico: <strong><%= payload.tech.name %></strong> — <%= payload.tech.email %></div>
        <div class="card">Fecha: <strong><%= new Date(payload.date).toLocaleString(payload.metadata.idioma || 'es-ES') %></strong></div>
      </div>
    </div>

    <div class="section">
      <h3>Diagnóstico</h3>
      <div class="card"><%= payload.form.diagnosis || '-' %></div>
    </div>

    <div class="section">
      <h3>Pruebas realizadas</h3>
      <div class="card"><%= payload.form.tests || '-' %></div>
    </div>

    <div class="section">
      <h3>Recomendaciones</h3>
      <div class="card"><%= payload.form.recommendations || '-' %></div>
    </div>

    <div class="section">
      <h3>Configuraciones y Software</h3>
      <div class="card">
        <div>Configuraciones: <%= payload.form.configurations || '-' %></div>
        <div>Software instalado: <%= (payload.form.softwareInstalled || []).join(', ') %></div>
      </div>
    </div>

    <div class="section photos">
      <h3>Fotos</h3>
      <% photos.forEach(function(p){ %>
        <img src="<%= p %>" alt="foto" />
      <% }) %>
    </div>

    <div class="section signature">
      <h3>Firma</h3>
      <% if (signatureUrl) { %>
        <img src="<%= signatureUrl %>" alt="firma" />
      <% } else { %>
        <div class="card">Sin firma</div>
      <% } %>
    </div>

    <div class="section">
      <h3>Observaciones</h3>
      <div class="card"><%= payload.form.observations || '-' %></div>
    </div>

    <footer style="margin-top:24px;font-size:11px;color:var(--muted)">Informe generado por <%= user && user.nombre ? user.nombre : 'Sistema' %> • <%= new Date().toLocaleString() %></footer>
  </body>
</html>
